language: python
dist: bionic
services:
  - docker

env:
  - CI_TARGET=unit_tests
  - CI_TARGET=integration_tests
  - CI_TARGET=ci_housekeeping
  - CI_TARGET=skylab_bulk_rna

script:
  - |
      set -exo pipefail
      make docker
      docker run --env TRAVIS_JOB_ID=${TRAVIS_JOB_ID} --env TRAVIS_BRANCH=${TRAVIS_BRANCH} \
                  --group-add $(stat -c %g /var/run/docker.sock) -v /var/run/docker.sock:/var/run/docker.sock -v /tmp:/tmp \
                  miniwdl bash -c "make $CI_TARGET && coveralls"

jobs:
  allow_failures:
    - env: CI_TARGET=skylab_bulk_rna
  fast_finish: true
